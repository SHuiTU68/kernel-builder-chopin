name: Manual Build (with Switches)

on:
  workflow_dispatch:
    inputs:
      # --- 核心源码配置输入框 ---
      repo_url:
        description: '内核源码仓库地址 (Kernel Repo URL)'
        required: true
        default: 'https://github.com/ChopinKernels/kernel_xiaomi_chopin_android_S'
      
      repo_branch:
        description:'S'
        required: true
        default: 'master'  # 这里默认填 master，如果你用其他仓库，记得手动改
      
      device_name:
        description: '设备代号 (Device Name)'
        required: true
        default: 'chopin'
        
      defconfig_name:
        description: '配置文件名 (Defconfig)'
        required: true
        default: 'chopin_defconfig'

      # --- 功能开关 (Checkbox) ---
      enable_kpm:
        description: '是否打开 KPM (KernelSU)'
        type: boolean
        default: true  # 默认打勾
      
      enable_susfs:
        description: '是否写入 SUSFS 补丁'
        type: boolean
        default: true  # 默认打勾

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Source
        uses: actions/checkout@v4

      # 调用 ReSukiSU 进行构建
      - name: Run ReSukiSU Build
        uses: ReSukiSU/ReSukiSU@main
        env:
          # 将上面输入框的值 (inputs) 传给环境变量
          KERNEL_REPO: ${{ inputs.repo_url }}
          KERNEL_BRANCH: ${{ inputs.repo_branch }}
          KERNEL_DEVICE: ${{ inputs.device_name }}
          KERNEL_DEFCONFIG: ${{ inputs.defconfig_name }}
          
          # 这里对应你的开关需求
          ENABLE_KERNELSU: ${{ inputs.enable_kpm }}
          ENABLE_SUSFS: ${{ inputs.enable_susfs }}
          
          # 其他固定配置 (推荐开启 ccache 加速)
          ENABLE_CCACHE: true
          USE_ANYKERNEL3: true
          
          # GitHub Token 用于发布 Release
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
